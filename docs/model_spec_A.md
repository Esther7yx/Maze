# MazeGame 模型规范文档 - 成员A（场景与建模）

## 文档概述

本文档定义了MazeGame项目的所有3D模型资产规范，包括坐标系约定、模型列表、材质语义和机关位置信息。这是成员B（渲染）、成员C（逻辑）、成员D（架构）必须遵循的接口文档。

## 1. 坐标系统约定

### 1.1 坐标系
- **右手坐标系**：X轴向右，Y轴向上，Z轴向屏幕内
- **单位尺度**：1.0 = 1米
- **地面高度**：y = 0

### 1.2 空间尺度规范
- **墙高**：3.0米
- **墙厚**：0.3米
- **通道宽度**：2.5米
- **最小转弯间距**：≥ 4.0米

## 2. 模型资产列表

### 2.1 核心模型文件

| 文件名 | 功能描述 | 是否可交互 | 碰撞类型 |
|--------|----------|------------|----------|
| `maze_walls.obj` | 所有不可破坏墙体 | 否 | AABB |
| `maze_floor.obj` | 迷宫地面 | 否 | 平面 |
| `door_gate.obj` | 可交互铁门 | 是（钥匙触发） | AABB |
| `pressure_plate.obj` | 压力板机关 | 是 | AABB |
| `torch_holder.obj` | 火把基座 | 是（发光） | AABB |

### 2.2 模型生成方式
- **生成工具**：`tools/build_maze_geometry.py`（OpenGL程序化建模）
- **导出格式**：标准Wavefront OBJ
- **更新方式**：运行脚本重新生成

## 3. 材质ID语义规范（给成员B使用）

### 3.1 材质ID列表

| 材质ID | 表面类型 | 光照特性 | 反射率 | 发光强度 |
|--------|----------|----------|--------|----------|
| `WALL_STONE` | 石墙表面 | 漫反射 | 0.3 | 0.0 |
| `FLOOR_GROUND` | 地面 | 漫反射 | 0.2 | 0.0 |
| `METAL_GATE` | 铁门金属 | 高光反射 | 0.7 | 0.0 |
| `PLATE_METAL` | 压力板金属 | 中等反射 | 0.5 | 0.0 |
| `EMISSIVE_TORCH` | 火把发光 | 自发光 | 0.1 | 1.0 |

### 3.2 材质使用示例
```obj
# 在OBJ文件中的使用方式
usemtl WALL_STONE
f 1 2 3
f 3 4 1

usemtl METAL_GATE
f 5 6 7
f 7 8 5
```

## 4. 迷宫路线设计

### 4.1 总体路线结构
```
[起点区] (0,0,0)
    ↓ +X方向
[教学走廊] (3→13,0,0)
    ↓ 
[火把教学区] (13,0,0)
    ↓ -Z方向转弯
[压力板区] (16,0,-4)
    ↓ +X方向
[铁门区] (18,0,-4)
    ↓ +X方向
[核心机关区] (22,0,-4)
    ↓ +X方向
[终点区] (30,0,-4)
```

### 4.2 假路设计（视觉干扰）
```
[主路分支点] (10,0,0)
    ↓ +Z方向
[假路通道] (10,0,0→6)
    ↓ 
[死路末端] (10,0,6) - 被墙体封死
```

## 5. 机关空间位置（给成员C使用）

### 5.1 机关坐标与尺寸

#### 压力板机关
```yaml
PressurePlate_01:
  position: [16.0, 0.1, -4.0]  # 稍微高于地面
  size: [1.5, 0.2, 1.5]        # 宽度,高度,深度
  trigger_type: "pressure"
  required_item: null           # 无需物品触发
```

#### 铁门机关
```yaml
DoorGate_01:
  position: [18.0, 1.5, -4.0]  # 中心点高度
  size: [2.5, 3.0, 0.3]        # 完全挡路尺寸
  trigger_type: "key"
  required_item: "gate_key"
  locked: true                  # 初始状态：锁定
```

#### 火把机关
```yaml
TorchHolder_01:
  position: [13.0, 0.6, 0.0]   # 基座中心
  size: [0.5, 1.2, 0.5]        # 火把基座尺寸
  trigger_type: "light"
  light_intensity: 2.0          # 发光强度
  is_lit: false                 # 初始状态：未点燃
```

### 5.2 碰撞检测参数
- **玩家碰撞体**：球体，半径0.5米
- **机关碰撞检测**：AABB边界框
- **触发距离**：1.0米范围内

## 6. 模型数据结构规范

### 6.1 OBJ文件格式要求
```python
# 模型数据在代码中的表示
model_data = {
    'vertices': np.array([[x1, y1, z1], [x2, y2, z2], ...]),
    'faces': np.array([[v1, v2, v3], [v4, v5, v6], ...]),
    'material_groups': {
        'WALL_STONE': [face_index1, face_index2, ...],
        'METAL_GATE': [face_index3, face_index4, ...]
    }
}
```

### 6.2 顶点索引规范
- **面索引**：从1开始（OBJ标准）
- **三角形面**：所有面必须为三角形
- **法线方向**：面向观察者的面为正面

## 7. 资产更新与维护

### 7.1 模型更新流程
1. 修改 `tools/build_maze_geometry.py` 脚本
2. 运行脚本生成新的OBJ文件
3. 更新本文档中的坐标和尺寸信息
4. 通知团队成员检查兼容性

### 7.2 版本控制
- **模型版本**：v1.0.0（初始版本）
- **最后更新**：2026年1月17日
- **变更记录**：初始版本创建

## 8. 与其他成员的接口

### 8.1 与成员B（渲染）的接口
- **输入**：OBJ文件 + 材质ID
- **输出**：渲染后的3D场景
- **关键依赖**：材质语义规范（第3节）

### 8.2 与成员C（逻辑）的接口
- **输入**：机关坐标与尺寸（第5节）
- **输出**：交互逻辑实现
- **关键依赖**：碰撞检测参数

### 8.3 与成员D（架构）的接口
- **输入**：模型命名规范
- **输出**：资源加载系统
- **关键依赖**：文件路径和格式

## 9. 质量保证

### 9.1 模型质量要求
- ✅ 所有面为三角形
- ✅ 法线方向一致
- ✅ 无重叠顶点
- ✅ UV坐标正确（如果使用纹理）

### 9.2 性能优化建议
- 单个OBJ文件顶点数 ≤ 1000
- 使用材质分组减少绘制调用
- 避免过于复杂的几何细节

---

## 文档维护
- **负责人**：成员A
- **最后审核**：2026年1月17日
- **下次审核**：模型有重大变更时

---

## 当前 OBJ 为几何 MVP 版本说明

### 设计原则：最小可用实现
当前生成的 OBJ 文件采用**几何 MVP（最小可用产品）**设计原则，确保：
- ✅ 能被 `ResourceLoader` 稳定读取
- ✅ 满足课程作业核心要求
- ✅ 不破坏现有工程结构

### 当前实现状态
| 功能 | 状态 | 说明 |
|------|------|------|
| **顶点 (v)** | ✅ 已实现 | 完整几何数据 |
| **面 (f)** | ✅ 已实现 | 三角形面片，1-based索引 |
| **材质 (usemtl)** | ✅ 已实现 | 逻辑材质分组 |
| **法线 (vn)** | 🔄 接口预留 | 可由光追模块运行时计算 |
| **UV (vt)** | 🔄 接口预留 | 纯色材质，无需纹理映射 |
| **材质文件 (.mtl)** | ❌ 未实现 | 逻辑材质语义，非PBR材质 |

### 后续扩展能力
当前设计已为未来功能扩展预留接口：
- **法线计算**：可在 `OBJMesh` 中添加法线数据
- **纹理映射**：可在 `add_box/add_floor_plane` 中添加UV坐标
- **高级材质**：可扩展为完整的PBR材质系统

### 团队协作建议
- **成员B（光追）**：当前几何数据可直接用于BVH构建，法线可运行时计算
- **成员C（机关）**：AABB碰撞检测完全支持当前几何结构  
- **成员D（资源加载）**：当前OBJ格式为最简化版本，确保读取稳定性

---

**注：本MVP版本已通过课程验收标准，后续可根据项目需求逐步扩展功能。**